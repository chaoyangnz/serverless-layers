{"version":3,"sources":["../../src/runtimes/index.js"],"names":["exec","require","ruby","nodejs","python","Runtimes","constructor","plugin","runtime","service","provider","error","process","exit","patterns","env","test","_runtime","log","isCompatibleVersion","then","data","isCompatible","version","replace","init","run","cmd","Promise","resolve","reject","err","stdout","out","getDefaultSettings","inboundSettings","packagePath","console","warn","dependenciesPath","default","getCommands","commands","hasDependencesChanged","module","exports"],"mappings":"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","sourcesContent":["const { exec } = require('child_process');\n\nconst ruby = require('./ruby');\nconst nodejs = require('./nodejs');\nconst python = require('./python');\n\nclass Runtimes {\n  constructor(plugin) {\n    this.plugin = plugin;\n\n    const { runtime } = this.plugin.service.provider;\n\n    if (!runtime) {\n      this.plugin.error('service.provider.runtime is required!');\n      return process.exit(1);\n    }\n\n    const patterns = {\n      python: [/python/, python],\n      nodejs: [/node/, nodejs],\n      ruby: [/ruby/, ruby],\n    };\n\n    for (const env in patterns) {\n      if (patterns[env][0].test(runtime)) {\n        this._runtime = new patterns[env][1](this, runtime, env);\n        break;\n      }\n    }\n\n    if (!this._runtime) {\n      this.plugin.log(`\"${runtime}\" runtime is not supported (yet).`);\n      return process.exit(1);\n    }\n\n    this._runtime.isCompatibleVersion(runtime)\n      .then((data) => {\n        if (!data.isCompatible) {\n          this.plugin.error('=============================================================');\n          this.plugin.error(`NOTE: You're currently using incompatible version [${data.version.replace('\\n', '')}]`);\n          this.plugin.error('=============================================================\\n');\n        }\n      });\n  }\n\n  init() {\n    this._runtime.init();\n  }\n\n  run(cmd) {\n    return new Promise((resolve, reject) => {\n      exec(cmd, (err, stdout, out) => {\n        if (err) return reject(err);\n        return resolve(stdout || out);\n      });\n    });\n  }\n\n  getDefaultSettings(inboundSettings = {}) {\n    if (inboundSettings.packagePath) {\n      console.warn('WARN You should use \"dependenciesPath\" instead of the deprecated \"packagePath\" param.');\n      inboundSettings.dependenciesPath = inboundSettings.packagePath;\n    }\n    return { ...this._runtime.default, ...inboundSettings };\n  }\n\n  getCommands() {\n    return this._runtime.commands;\n  }\n\n  hasDependencesChanged() {\n    return this._runtime.hasDependencesChanged();\n  }\n}\n\nmodule.exports = Runtimes;\n"],"file":"index.js"}